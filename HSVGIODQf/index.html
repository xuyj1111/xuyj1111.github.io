<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ã€è½¬è½½ã€‘ç©è½¬Springä¸­å¼ºå¤§çš„spelè¡¨è¾¾å¼ï¼ | æ´—è¡£æœºçš„åšå®¢</title>
<link rel="shortcut icon" href="https://xuyj1111.github.io/favicon.ico?v=1727363389169">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://xuyj1111.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="ã€è½¬è½½ã€‘ç©è½¬Springä¸­å¼ºå¤§çš„spelè¡¨è¾¾å¼ï¼ | æ´—è¡£æœºçš„åšå®¢ - Atom Feed" href="https://xuyj1111.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="
ç©è½¬Springä¸­å¼ºå¤§çš„spelè¡¨è¾¾å¼ï¼ï¼Œby æ— æƒ…çš„BUGæ€æ‰‹

Spel æ¦‚è¿°
Spring è¡¨è¾¾å¼è¯­è¨€å…¨ç§°ä¸º â€œSpring Expression Languageâ€ï¼Œç¼©å†™ä¸º â€œSpELâ€ï¼Œç±»ä¼¼äº Struts2x ä¸­ä½¿ç”¨çš„ OGN..." />
    <meta name="keywords" content="Java,è½¬è½½" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

 <script src='//unpkg.com/valine/dist/Valine.min.js'></script>

  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://xuyj1111.github.io">
  <img class="avatar" src="https://xuyj1111.github.io/images/avatar.png?v=1727363389169" alt="">
  </a>
  <h1 class="site-title">
    æ´—è¡£æœºçš„åšå®¢
  </h1>
  <p class="site-description">
    ã€ä¸€åJavaå¼€å‘ã€‘slaveğŸ‘‰https://www.cnblogs.com/xuyj1111/
  </p>
  <div class="menu-container">
    
      
        <a href="https://xuyj1111.github.io" class="menu">
          ä¸»é¡µ
        </a>
      
    
      
        <a href="https://xuyj1111.github.io/archives" class="menu">
          æ–‡ç« 
        </a>
      
    
      
        <a href="https://xuyj1111.github.io/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/xuyj1111" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
    
      
    
      
    
      
    
  </div>
  <form id="gridea-search-form" action="https://xuyj1111.github.io/search/">
    <input name="q" />
  </form>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              ã€è½¬è½½ã€‘ç©è½¬Springä¸­å¼ºå¤§çš„spelè¡¨è¾¾å¼ï¼
            </h2>
            <div class="post-info">
              <span>
                2023-02-16
              </span>
              <span>
                32 min read
              </span>
              
                <a href="https://xuyj1111.github.io/SOje8Joqr/" class="post-tag">
                  # Java
                </a>
              
                <a href="https://xuyj1111.github.io/JDrWa3FBq/" class="post-tag">
                  # è½¬è½½
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/174786047">ç©è½¬Springä¸­å¼ºå¤§çš„spelè¡¨è¾¾å¼ï¼</a>ï¼Œby æ— æƒ…çš„BUGæ€æ‰‹</p>
</blockquote>
<h2 id="spel-æ¦‚è¿°"><strong>Spel æ¦‚è¿°</strong></h2>
<p>Spring è¡¨è¾¾å¼è¯­è¨€å…¨ç§°ä¸º â€œSpring Expression Languageâ€ï¼Œç¼©å†™ä¸º â€œSpELâ€ï¼Œç±»ä¼¼äº Struts2x ä¸­ä½¿ç”¨çš„ OGNL è¡¨è¾¾å¼è¯­è¨€ï¼Œèƒ½åœ¨è¿è¡Œæ—¶æ„å»ºå¤æ‚è¡¨è¾¾å¼ã€å­˜å–å¯¹è±¡å›¾å±æ€§ã€å¯¹è±¡æ–¹æ³•è°ƒç”¨ç­‰ç­‰ï¼Œå¹¶ä¸”èƒ½ä¸ Spring åŠŸèƒ½å®Œç¾æ•´åˆï¼Œå¦‚èƒ½ç”¨æ¥é…ç½® Bean å®šä¹‰ã€‚</p>
<p><strong>è¡¨è¾¾å¼è¯­è¨€ç»™é™æ€ Java è¯­è¨€å¢åŠ äº†åŠ¨æ€åŠŸèƒ½ã€‚</strong></p>
<p>SpEL æ˜¯å•ç‹¬æ¨¡å—ï¼Œåªä¾èµ–äº core æ¨¡å—ï¼Œä¸ä¾èµ–äºå…¶ä»–æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚</p>
<h2 id="spel-èƒ½å¹²ä»€ä¹ˆ"><strong>Spel èƒ½å¹²ä»€ä¹ˆ?</strong></h2>
<p>è¡¨è¾¾å¼è¯­è¨€ä¸€èˆ¬æ˜¯ç”¨æœ€ç®€å•çš„å½¢å¼å®Œæˆæœ€ä¸»è¦çš„å·¥ä½œï¼Œå‡å°‘æˆ‘ä»¬çš„å·¥ä½œé‡ã€‚</p>
<p>SpEL æ”¯æŒå¦‚ä¸‹è¡¨è¾¾å¼ï¼š</p>
<p><strong>ä¸€ã€åŸºæœ¬è¡¨è¾¾å¼ï¼š</strong> å­—é¢é‡è¡¨è¾¾å¼ã€å…³ç³»ï¼Œé€»è¾‘ä¸ç®—æ•°è¿ç®—è¡¨è¾¾å¼ã€å­—ç¬¦ä¸²è¿æ¥åŠæˆªå–è¡¨è¾¾å¼ã€ä¸‰ç›®è¿ç®—åŠ Elivis è¡¨è¾¾å¼ã€æ­£åˆ™è¡¨è¾¾å¼ã€æ‹¬å·ä¼˜å…ˆçº§è¡¨è¾¾å¼ï¼›</p>
<p><strong>äºŒã€ç±»ç›¸å…³è¡¨è¾¾å¼ï¼š</strong> ç±»ç±»å‹è¡¨è¾¾å¼ã€ç±»å®ä¾‹åŒ–ã€instanceof è¡¨è¾¾å¼ã€å˜é‡å®šä¹‰åŠå¼•ç”¨ã€èµ‹å€¼è¡¨è¾¾å¼ã€è‡ªå®šä¹‰å‡½æ•°ã€å¯¹è±¡å±æ€§å­˜å–åŠå®‰å…¨å¯¼èˆªè¡¨è¾¾å¼ã€å¯¹è±¡æ–¹æ³•è°ƒç”¨ã€Bean å¼•ç”¨ï¼›</p>
<p><strong>ä¸‰ã€é›†åˆç›¸å…³è¡¨è¾¾å¼ï¼š</strong> å†…è” Listã€å†…è”æ•°ç»„ã€é›†åˆï¼Œå­—å…¸è®¿é—®ã€åˆ—è¡¨ï¼Œå­—å…¸ï¼Œæ•°ç»„ä¿®æ”¹ã€é›†åˆæŠ•å½±ã€é›†åˆé€‰æ‹©ï¼›ä¸æ”¯æŒå¤šç»´å†…è”æ•°ç»„åˆå§‹åŒ–ï¼›ä¸æ”¯æŒå†…è”å­—å…¸å®šä¹‰ï¼›</p>
<p><strong>å››ã€å…¶ä»–è¡¨è¾¾å¼</strong>ï¼šæ¨¡æ¿è¡¨è¾¾å¼ã€‚</p>
<p><strong>æ³¨ï¼šSpEL è¡¨è¾¾å¼ä¸­çš„å…³é”®å­—æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚</strong></p>
<h2 id="spel-åŸºç¡€"><strong>SpEL åŸºç¡€</strong></h2>
<h3 id="helloworld"><strong>HelloWorld</strong></h3>
<p>é¦–å…ˆå‡†å¤‡æ”¯æŒ SpEL çš„ Jar åŒ…ï¼šâ€œorg.springframework.expression-3.0.5.RELEASE.jarâ€ å°†å…¶æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ã€‚</p>
<p>SpEL åœ¨æ±‚è¡¨è¾¾å¼å€¼æ—¶ä¸€èˆ¬åˆ†ä¸ºå››æ­¥ï¼Œå…¶ä¸­ç¬¬ä¸‰æ­¥å¯é€‰ï¼šé¦–å…ˆæ„é€ ä¸€ä¸ªè§£æå™¨ï¼Œå…¶æ¬¡è§£æå™¨è§£æå­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œåœ¨æ­¤æ„é€ ä¸Šä¸‹æ–‡ï¼Œæœ€åæ ¹æ®ä¸Šä¸‹æ–‡å¾—åˆ°è¡¨è¾¾å¼è¿ç®—åçš„å€¼ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸‹ä»£ç ç‰‡æ®µå§ï¼š</p>
<pre><code class="language-java">package com.javacode2018.spel;

import org.junit.Test;
import org.springframework.expression.EvaluationContext;
import org.springframework.expression.Expression;
import org.springframework.expression.ExpressionParser;
import org.springframework.expression.spel.standard.SpelExpressionParser;
import org.springframework.expression.spel.support.StandardEvaluationContext;

public class SpelTest {
    @Test
    public void test1() {
        ExpressionParser parser = new SpelExpressionParser();
        Expression expression = parser.parseExpression(&quot;('Hello' + ' World').concat(#end)&quot;);
        EvaluationContext context = new StandardEvaluationContext();
        context.setVariable(&quot;end&quot;, &quot;!&quot;);
        System.out.println(expression.getValue(context));
    }
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>Hello World!

</code></pre>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬åˆ†æä¸‹ä»£ç ï¼š</p>
<p>1ï¼‰åˆ›å»ºè§£æå™¨ï¼š<strong>SpEL ä½¿ç”¨ ExpressionParser æ¥å£è¡¨ç¤ºè§£æå™¨ï¼Œæä¾› SpelExpressionParser é»˜è®¤å®ç°ï¼›</strong></p>
<p>2ï¼‰è§£æè¡¨è¾¾å¼ï¼šä½¿ç”¨ ExpressionParser çš„ parseExpression æ¥è§£æç›¸åº”çš„è¡¨è¾¾å¼ä¸º Expression å¯¹è±¡ã€‚</p>
<p>3ï¼‰æ„é€ ä¸Šä¸‹æ–‡ï¼šå‡†å¤‡æ¯”å¦‚å˜é‡å®šä¹‰ç­‰ç­‰è¡¨è¾¾å¼éœ€è¦çš„ä¸Šä¸‹æ–‡æ•°æ®ã€‚</p>
<p>4ï¼‰æ±‚å€¼ï¼šé€šè¿‡ Expression æ¥å£çš„ getValue æ–¹æ³•æ ¹æ®ä¸Šä¸‹æ–‡è·å¾—è¡¨è¾¾å¼å€¼ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸‹å…¶å…·ä½“å®ç°åŠåŸç†å§ã€‚</p>
<h3 id="spel-åŸç†åŠæ¥å£"><strong>SpEL åŸç†åŠæ¥å£</strong></h3>
<p>SpEL æä¾›ç®€å•çš„æ¥å£ä»è€Œç®€åŒ–ç”¨æˆ·ä½¿ç”¨ï¼Œåœ¨ä»‹ç»åŸç†å‰è®©æˆ‘ä»¬å­¦ä¹ ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p>
<p><strong>ä¸€ã€è¡¨è¾¾å¼ï¼š</strong> è¡¨è¾¾å¼æ˜¯è¡¨è¾¾å¼è¯­è¨€çš„æ ¸å¿ƒï¼Œæ‰€ä»¥è¡¨è¾¾å¼è¯­è¨€éƒ½æ˜¯å›´ç»•è¡¨è¾¾å¼è¿›è¡Œçš„ï¼Œä»æˆ‘ä»¬è§’åº¦æ¥çœ‹æ˜¯ â€œå¹²ä»€ä¹ˆâ€ï¼›</p>
<p><strong>äºŒã€è§£æå™¨ï¼š</strong> ç”¨äºå°†å­—ç¬¦ä¸²è¡¨è¾¾å¼è§£æä¸ºè¡¨è¾¾å¼å¯¹è±¡ï¼Œä»æˆ‘ä»¬è§’åº¦æ¥çœ‹æ˜¯ â€œè°æ¥å¹²â€ï¼›</p>
<p><strong>ä¸‰ã€ä¸Šä¸‹æ–‡ï¼š</strong> è¡¨è¾¾å¼å¯¹è±¡æ‰§è¡Œçš„ç¯å¢ƒï¼Œè¯¥ç¯å¢ƒå¯èƒ½å®šä¹‰å˜é‡ã€å®šä¹‰è‡ªå®šä¹‰å‡½æ•°ã€æä¾›ç±»å‹è½¬æ¢ç­‰ç­‰ï¼Œä»æˆ‘ä»¬è§’åº¦çœ‹æ˜¯ â€œåœ¨å“ªå¹²â€ï¼›</p>
<p><strong>å››ã€æ ¹å¯¹è±¡åŠæ´»åŠ¨ä¸Šä¸‹æ–‡å¯¹è±¡ï¼š</strong> æ ¹å¯¹è±¡æ˜¯é»˜è®¤çš„æ´»åŠ¨ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ´»åŠ¨ä¸Šä¸‹æ–‡å¯¹è±¡è¡¨ç¤ºäº†å½“å‰è¡¨è¾¾å¼æ“ä½œçš„å¯¹è±¡ï¼Œä»æˆ‘ä»¬è§’åº¦çœ‹æ˜¯ â€œå¯¹è°å¹²â€ã€‚</p>
<p>ç†è§£äº†è¿™äº›æ¦‚å¿µåï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹ SpEL å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://pic4.zhimg.com/v2-9ccd1f26794f5ab75681e5d6d7b000e7_r.jpg" alt="" loading="lazy"></figure>
<h3 id="å·¥ä½œåŸç†"><strong>å·¥ä½œåŸç†</strong></h3>
<pre><code>1.é¦–å…ˆå®šä¹‰è¡¨è¾¾å¼ï¼šâ€œ1+2â€ï¼›
2.å®šä¹‰è§£æå™¨ExpressionParserå®ç°ï¼ŒSpELæä¾›é»˜è®¤å®ç°SpelExpressionParserï¼›
  2.1.SpelExpressionParserè§£æå™¨å†…éƒ¨ä½¿ç”¨Tokenizerç±»è¿›è¡Œè¯æ³•åˆ†æï¼Œå³æŠŠå­—ç¬¦ä¸²æµåˆ†æä¸ºè®°å·æµï¼Œè®°å·åœ¨SpELä½¿ç”¨Tokenç±»æ¥è¡¨ç¤ºï¼›
  2.2.æœ‰äº†è®°å·æµåï¼Œè§£æå™¨ä¾¿å¯æ ¹æ®è®°å·æµç”Ÿæˆå†…éƒ¨æŠ½è±¡è¯­æ³•æ ‘ï¼›åœ¨SpELä¸­è¯­æ³•æ ‘èŠ‚ç‚¹ç”±SpelNodeæ¥å£å®ç°ä»£è¡¨ï¼šå¦‚OpPlusè¡¨ç¤ºåŠ æ“ä½œèŠ‚ç‚¹ã€IntLiteralè¡¨ç¤ºintå‹å­—é¢é‡èŠ‚ç‚¹ï¼›ä½¿ç”¨SpelNodelå®ç°ç»„æˆäº†æŠ½è±¡è¯­æ³•æ ‘ï¼›
  2.3.å¯¹å¤–æä¾›Expressionæ¥å£æ¥ç®€åŒ–è¡¨ç¤ºæŠ½è±¡è¯­æ³•æ ‘ï¼Œä»è€Œéšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›getValueç®€å•æ–¹æ³•ç”¨äºè·å–è¡¨è¾¾å¼å€¼ï¼›SpELæä¾›é»˜è®¤å®ç°ä¸ºSpelExpressionï¼›
3.å®šä¹‰è¡¨è¾¾å¼ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆå¯é€‰ï¼‰ï¼ŒSpELä½¿ç”¨EvaluationContextæ¥å£è¡¨ç¤ºä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç”¨äºè®¾ç½®æ ¹å¯¹è±¡ã€è‡ªå®šä¹‰å˜é‡ã€è‡ªå®šä¹‰å‡½æ•°ã€ç±»å‹è½¬æ¢å™¨ç­‰ï¼ŒSpELæä¾›é»˜è®¤å®ç°StandardEvaluationContextï¼›
4.ä½¿ç”¨è¡¨è¾¾å¼å¯¹è±¡æ ¹æ®ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆå¯é€‰ï¼‰æ±‚å€¼ï¼ˆè°ƒç”¨è¡¨è¾¾å¼å¯¹è±¡çš„getValueæ–¹æ³•ï¼‰è·å¾—ç»“æœã€‚

</code></pre>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸‹ SpEL çš„ä¸»è¦æ¥å£å§ï¼š</p>
<h3 id="expressionparser-æ¥å£"><strong>ExpressionParser æ¥å£</strong></h3>
<p>è¡¨ç¤ºè§£æå™¨ï¼Œé»˜è®¤å®ç°æ˜¯ org.springframework.expression.spel.standard åŒ…ä¸­çš„ SpelExpressionParser ç±»ï¼Œä½¿ç”¨ parseExpression æ–¹æ³•å°†å­—ç¬¦ä¸²è¡¨è¾¾å¼è½¬æ¢ä¸º Expression å¯¹è±¡ï¼Œå¯¹äº ParserContext æ¥å£ç”¨äºå®šä¹‰å­—ç¬¦ä¸²è¡¨è¾¾å¼æ˜¯ä¸æ˜¯æ¨¡æ¿ï¼ŒåŠæ¨¡æ¿å¼€å§‹ä¸ç»“æŸå­—ç¬¦ï¼š</p>
<pre><code class="language-java">public interface ExpressionParser {
 Expression parseExpression(String expressionString) throws ParseException;
 Expression parseExpression(String expressionString, ParserContext context) throws ParseException;
}

</code></pre>
<p>æ¥çœ‹ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-java">@Test
public void testParserContext() {
    ExpressionParser parser = new SpelExpressionParser();
    ParserContext parserContext = new ParserContext() {
        @Override
        public boolean isTemplate() {
            return true;
        }

        @Override
        public String getExpressionPrefix() {
            return &quot;#{&quot;;
        }

        @Override
        public String getExpressionSuffix() {
            return &quot;}&quot;;
        }
    };
    String template = &quot;#{'Hello '}#{'World!'}&quot;;
    Expression expression = parser.parseExpression(template, parserContext);
    System.out.println(expression.getValue());
}

</code></pre>
<p>åœ¨æ­¤æˆ‘ä»¬æ¼”ç¤ºçš„æ˜¯ä½¿ç”¨ ParserContext çš„æƒ…å†µï¼Œæ­¤å¤„å®šä¹‰äº† ParserContext å®ç°ï¼šå®šä¹‰è¡¨è¾¾å¼æ˜¯æ¨¡å—ï¼Œè¡¨è¾¾å¼å‰ç¼€ä¸º â€œ#{â€ï¼Œåç¼€ä¸ºâ€œ}â€ï¼›ä½¿ç”¨ parseExpression è§£ææ—¶ä¼ å…¥çš„æ¨¡æ¿å¿…é¡»ä»¥â€œ#{â€ å¼€å¤´ï¼Œä»¥ â€œ}â€ ç»“å°¾ï¼Œå¦‚ &quot;#{'Hello '}#{'World!'}&quot;ã€‚</p>
<p>é»˜è®¤ä¼ å…¥çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼ä¸æ˜¯æ¨¡æ¿å½¢å¼ï¼Œå¦‚ä¹‹å‰æ¼”ç¤ºçš„ Hello Worldã€‚</p>
<h3 id="evaluationcontext-æ¥å£"><strong>EvaluationContext æ¥å£</strong></h3>
<p>è¡¨ç¤ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œé»˜è®¤å®ç°æ˜¯ org.springframework.expression.spel.support åŒ…ä¸­çš„ StandardEvaluationContext ç±»ï¼Œä½¿ç”¨ setRootObject æ–¹æ³•æ¥è®¾ç½®æ ¹å¯¹è±¡ï¼Œä½¿ç”¨ setVariable æ–¹æ³•æ¥æ³¨å†Œè‡ªå®šä¹‰å˜é‡ï¼Œä½¿ç”¨ registerFunction æ¥æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°ç­‰ç­‰ã€‚</p>
<h3 id="expression-æ¥å£"><strong>Expression æ¥å£</strong></h3>
<p>è¡¨ç¤ºè¡¨è¾¾å¼å¯¹è±¡ï¼Œé»˜è®¤å®ç°æ˜¯ org.springframework.expression.spel.standard åŒ…ä¸­çš„ SpelExpressionï¼Œæä¾› getValue æ–¹æ³•ç”¨äºè·å–è¡¨è¾¾å¼å€¼ï¼Œæä¾› setValue æ–¹æ³•ç”¨äºè®¾ç½®å¯¹è±¡å€¼ã€‚</p>
<p>äº†è§£äº† SpEL åŸç†åŠæ¥å£ï¼Œæ¥ä¸‹æ¥çš„äº‹æƒ…å°±æ˜¯ SpEL è¯­æ³•äº†ã€‚</p>
<h2 id="spel-è¯­æ³•"><strong>SpEL è¯­æ³•</strong></h2>
<h3 id="åŸºæœ¬è¡¨è¾¾å¼"><strong>åŸºæœ¬è¡¨è¾¾å¼</strong></h3>
<h3 id="å­—é¢é‡è¡¨è¾¾å¼"><strong>å­—é¢é‡è¡¨è¾¾å¼</strong></h3>
<p>SpEL æ”¯æŒçš„å­—é¢é‡åŒ…æ‹¬ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ç±»å‹ï¼ˆintã€longã€floatã€doubleï¼‰ã€å¸ƒå°”ç±»å‹ã€null ç±»å‹ã€‚</p>
<p>ç±»å‹ç¤ºä¾‹å­—ç¬¦ä¸² String str1 = parser.parseExpression(&quot;'Hello World!'&quot;).getValue(String.class); æ•°å­—ç±»å‹ int int1 = parser.parseExpression(&quot;1&quot;).getValue(Integer.class);</p>
<p>long long1 = parser.parseExpression(&quot;-1L&quot;).getValue(long.class);</p>
<p>float float1 = parser.parseExpression(&quot;1.1&quot;).getValue(Float.class);</p>
<p>double double1 = parser.parseExpression(&quot;1.1E+2&quot;).getValue(double.class);</p>
<p>int hex1 = parser.parseExpression(&quot;0xa&quot;).getValue(Integer.class);</p>
<p>long hex2 = parser.parseExpression(&quot;0xaL&quot;).getValue(long.class); å¸ƒå°”ç±»å‹ boolean true1 = parser.parseExpression(&quot;true&quot;).getValue(boolean.class);</p>
<p>boolean false1 = parser.parseExpression(&quot;false&quot;).getValue(boolean.class);null ç±»å‹ Object null1 = parser.parseExpression(&quot;null&quot;).getValue(Object.class);</p>
<pre><code class="language-java">@Test
public void test2() {
    ExpressionParser parser = new SpelExpressionParser();

    String str1 = parser.parseExpression(&quot;'Hello World!'&quot;).getValue(String.class);
    int int1 = parser.parseExpression(&quot;1&quot;).getValue(Integer.class);
    long long1 = parser.parseExpression(&quot;-1L&quot;).getValue(long.class);
    float float1 = parser.parseExpression(&quot;1.1&quot;).getValue(Float.class);
    double double1 = parser.parseExpression(&quot;1.1E+2&quot;).getValue(double.class);
    int hex1 = parser.parseExpression(&quot;0xa&quot;).getValue(Integer.class);
    long hex2 = parser.parseExpression(&quot;0xaL&quot;).getValue(long.class);
    boolean true1 = parser.parseExpression(&quot;true&quot;).getValue(boolean.class);
    boolean false1 = parser.parseExpression(&quot;false&quot;).getValue(boolean.class);
    Object null1 = parser.parseExpression(&quot;null&quot;).getValue(Object.class);

    System.out.println(&quot;str1=&quot; + str1);
    System.out.println(&quot;int1=&quot; + int1);
    System.out.println(&quot;long1=&quot; + long1);
    System.out.println(&quot;float1=&quot; + float1);
    System.out.println(&quot;double1=&quot; + double1);
    System.out.println(&quot;hex1=&quot; + hex1);
    System.out.println(&quot;hex2=&quot; + hex2);
    System.out.println(&quot;true1=&quot; + true1);
    System.out.println(&quot;false1=&quot; + false1);
    System.out.println(&quot;null1=&quot; + null1);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>str1=Hello World!
int1=1
long1=-1
float1=1.1
double1=110.0
hex1=10
hex2=10
true1=true
false1=false
null1=null

</code></pre>
<h3 id="ç®—æ•°è¿ç®—è¡¨è¾¾å¼"><strong>ç®—æ•°è¿ç®—è¡¨è¾¾å¼</strong></h3>
<p>SpEL æ”¯æŒåŠ  (+)ã€å‡ (-)ã€ä¹˜ (*)ã€é™¤ (/)ã€æ±‚ä½™ï¼ˆ%ï¼‰ã€å¹‚ï¼ˆ^ï¼‰è¿ç®—ã€‚</p>
<p>ç±»å‹ç¤ºä¾‹åŠ å‡ä¹˜é™¤ int result1 = parser.parseExpression(&quot;1+2-3*4/2&quot;).getValue(Integer.class);//-3 æ±‚ä½™ int result2 = parser.parseExpression(&quot;4%3&quot;).getValue(Integer.class);//1 å¹‚è¿ç®— int result3 = parser.parseExpression(&quot;2^3&quot;).getValue(Integer.class);//8</p>
<p>SpEL è¿˜æä¾›æ±‚ä½™ï¼ˆMODï¼‰å’Œé™¤ï¼ˆDIVï¼‰è€Œå¤–ä¸¤ä¸ªè¿ç®—ç¬¦ï¼Œä¸ â€œ%â€ å’Œâ€œ/â€ç­‰ä»·ï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚</p>
<h3 id="å…³ç³»è¡¨è¾¾å¼"><strong>å…³ç³»è¡¨è¾¾å¼</strong></h3>
<p>ç­‰äºï¼ˆ==ï¼‰ã€ä¸ç­‰äº (!=)ã€å¤§äº (&gt;)ã€å¤§äºç­‰äº (&gt;=)ã€å°äº (&lt;)ã€å°äºç­‰äº (&lt;=)ï¼ŒåŒºé—´ï¼ˆbetweenï¼‰è¿ç®—ã€‚</p>
<p>å¦‚<code>parser.parseExpression(&quot;1&gt;2&quot;).getValue(boolean.class);</code>å°†è¿”å› falseï¼›</p>
<p>è€Œ<code>parser.parseExpression(&quot;1 between {1, 2}&quot;).getValue(boolean.class);</code>å°†è¿”å› trueã€‚</p>
<p><code>betweenè¿ç®—ç¬¦å³è¾¹æ“ä½œæ•°å¿…é¡»æ˜¯åˆ—è¡¨ç±»å‹ï¼Œä¸”åªèƒ½åŒ…å«2ä¸ªå…ƒç´ ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå¼€å§‹ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºç»“æŸï¼ŒåŒºé—´è¿ç®—æ˜¯åŒ…å«è¾¹ç•Œå€¼çš„ï¼Œå³ xxx&gt;=list.get(0) &amp;&amp; xxx&lt;=list.get(1)</code>ã€‚</p>
<p>SpEL åŒæ ·æä¾›äº†ç­‰ä»·çš„ â€œEQâ€ ã€â€œNEâ€ã€ â€œGTâ€ã€â€œGEâ€ã€ â€œLTâ€ ã€â€œLEâ€ æ¥è¡¨ç¤ºç­‰äºã€ä¸ç­‰äºã€å¤§äºã€å¤§äºç­‰äºã€å°äºã€å°äºç­‰äºï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚</p>
<pre><code class="language-java">@Test
public void test3() {
    ExpressionParser parser = new SpelExpressionParser();
    boolean v1 = parser.parseExpression(&quot;1&gt;2&quot;).getValue(boolean.class);
    boolean between1 = parser.parseExpression(&quot;1 between {1,2}&quot;).getValue(boolean.class);
    System.out.println(&quot;v1=&quot; + v1);
    System.out.println(&quot;between1=&quot; + between1);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>v1=false
between1=true


</code></pre>
<h3 id="é€»è¾‘è¡¨è¾¾å¼"><strong>é€»è¾‘è¡¨è¾¾å¼</strong></h3>
<p>ä¸”ï¼ˆand æˆ–è€… &amp;&amp;ï¼‰ã€æˆ– (or æˆ–è€… ||)ã€é (! æˆ– NOT)ã€‚</p>
<pre><code class="language-java">@Test
public void test4() {
    ExpressionParser parser = new SpelExpressionParser();

    boolean result1 = parser.parseExpression(&quot;2&gt;1 and (!true or !false)&quot;).getValue(boolean.class);
    boolean result2 = parser.parseExpression(&quot;2&gt;1 &amp;&amp; (!true || !false)&quot;).getValue(boolean.class);

    boolean result3 = parser.parseExpression(&quot;2&gt;1 and (NOT true or NOT false)&quot;).getValue(boolean.class);
    boolean result4 = parser.parseExpression(&quot;2&gt;1 &amp;&amp; (NOT true || NOT false)&quot;).getValue(boolean.class);

    System.out.println(&quot;result1=&quot; + result1);
    System.out.println(&quot;result2=&quot; + result2);
    System.out.println(&quot;result3=&quot; + result3);
    System.out.println(&quot;result4=&quot; + result4);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>result1=true
result2=true
result3=true
result4=false

</code></pre>
<h3 id="å­—ç¬¦ä¸²è¿æ¥åŠæˆªå–è¡¨è¾¾å¼"><strong>å­—ç¬¦ä¸²è¿æ¥åŠæˆªå–è¡¨è¾¾å¼</strong></h3>
<p>ä½¿ç”¨ â€œ+â€ è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥ï¼Œä½¿ç”¨ â€œ'String'[0] [index]â€ æ¥æˆªå–ä¸€ä¸ªå­—ç¬¦ï¼Œç›®å‰åªæ”¯æŒæˆªå–ä¸€ä¸ªï¼Œå¦‚ â€œ'Hello' + 'World!'â€ å¾—åˆ° â€œHello World!â€ï¼›è€Œâ€œ'Hello World!'[0]â€ å°†è¿”å›â€œHâ€ã€‚</p>
<h3 id="ä¸‰ç›®è¿ç®—"><strong>ä¸‰ç›®è¿ç®—</strong></h3>
<p>ä¸‰ç›®è¿ç®—ç¬¦ <strong>â€œè¡¨è¾¾å¼ 1? è¡¨è¾¾å¼ 2: è¡¨è¾¾å¼ 3â€</strong> ç”¨äºæ„é€ ä¸‰ç›®è¿ç®—è¡¨è¾¾å¼ï¼Œå¦‚ â€œ2&gt;1?true:falseâ€ å°†è¿”å› trueï¼›</p>
<h3 id="elivis-è¿ç®—ç¬¦"><strong>Elivis è¿ç®—ç¬¦</strong></h3>
<p>Elivis è¿ç®—ç¬¦ <strong>â€œè¡¨è¾¾å¼ 1?: è¡¨è¾¾å¼ 2â€</strong> ä» Groovy è¯­è¨€å¼•å…¥ç”¨äºç®€åŒ–ä¸‰ç›®è¿ç®—ç¬¦çš„ï¼Œå½“è¡¨è¾¾å¼ 1 ä¸ºé null æ—¶åˆ™è¿”å›è¡¨è¾¾å¼ 1ï¼Œå½“è¡¨è¾¾å¼ 1 ä¸º null æ—¶åˆ™è¿”å›è¡¨è¾¾å¼ 2ï¼Œç®€åŒ–äº†ä¸‰ç›®è¿ç®—ç¬¦æ–¹å¼ â€œè¡¨è¾¾å¼ 1? è¡¨è¾¾å¼ 1: è¡¨è¾¾å¼ 2â€ï¼Œå¦‚â€œnull?:falseâ€ å°†è¿”å› falseï¼Œè€Œ â€œtrue?:falseâ€ å°†è¿”å› trueï¼›</p>
<h3 id="æ­£åˆ™è¡¨è¾¾å¼"><strong>æ­£åˆ™è¡¨è¾¾å¼</strong></h3>
<p>ä½¿ç”¨ â€œstr matches regexï¼Œå¦‚â€œ'123' matches '\d{3}'â€ å°†è¿”å› trueï¼›</p>
<h3 id="æ‹¬å·ä¼˜å…ˆçº§è¡¨è¾¾å¼"><strong>æ‹¬å·ä¼˜å…ˆçº§è¡¨è¾¾å¼</strong></h3>
<p>ä½¿ç”¨ â€œ(è¡¨è¾¾å¼)â€ æ„é€ ï¼Œæ‹¬å·é‡Œçš„å…·æœ‰é«˜ä¼˜å…ˆçº§ã€‚</p>
<h3 id="ç±»ç›¸å…³è¡¨è¾¾å¼"><strong>ç±»ç›¸å…³è¡¨è¾¾å¼</strong></h3>
<h3 id="ç±»ç±»å‹è¡¨è¾¾å¼"><strong>ç±»ç±»å‹è¡¨è¾¾å¼</strong></h3>
<p>ä½¿ç”¨ â€œT(Type)â€ æ¥è¡¨ç¤º java.lang.Class å®ä¾‹ï¼Œâ€œTypeâ€å¿…é¡»æ˜¯ç±»å…¨é™å®šåï¼Œâ€œjava.langâ€åŒ…é™¤å¤–ï¼Œå³è¯¥åŒ…ä¸‹çš„ç±»å¯ä»¥ä¸æŒ‡å®šåŒ…åï¼›ä½¿ç”¨ç±»ç±»å‹è¡¨è¾¾å¼è¿˜å¯ä»¥è¿›è¡Œè®¿é—®ç±»é™æ€æ–¹æ³•åŠç±»é™æ€å­—æ®µã€‚</p>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Test
public void testClassTypeExpression() {
    ExpressionParser parser = new SpelExpressionParser();
    //java.langåŒ…ç±»è®¿é—®
    Class&lt;String&gt; result1 = parser.parseExpression(&quot;T(String)&quot;).getValue(Class.class);
    System.out.println(result1);

    //å…¶ä»–åŒ…ç±»è®¿é—®
    String expression2 = &quot;T(com.javacode2018.spel.SpelTest)&quot;;
    Class&lt;SpelTest&gt; value = parser.parseExpression(expression2).getValue(Class.class);
    System.out.println(value == SpelTest.class);

    //ç±»é™æ€å­—æ®µè®¿é—®
    int result3 = parser.parseExpression(&quot;T(Integer).MAX_VALUE&quot;).getValue(int.class);
    System.out.println(result3 == Integer.MAX_VALUE);

    //ç±»é™æ€æ–¹æ³•è°ƒç”¨
    int result4 = parser.parseExpression(&quot;T(Integer).parseInt('1')&quot;).getValue(int.class);
    System.out.println(result4);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>class java.lang.String
true
true
1

</code></pre>
<p>å¯¹äº java.lang åŒ…é‡Œçš„å¯ä»¥ç›´æ¥ä½¿ç”¨ â€œT(String)â€ è®¿é—®ï¼›å…¶ä»–åŒ…å¿…é¡»æ˜¯ç±»å…¨é™å®šåï¼›å¯ä»¥è¿›è¡Œé™æ€å­—æ®µè®¿é—®å¦‚â€œT(Integer).MAX_VALUEâ€ï¼›ä¹Ÿå¯ä»¥è¿›è¡Œé™æ€æ–¹æ³•è®¿é—®å¦‚â€œT(Integer).parseInt('1')â€ã€‚</p>
<h3 id="ç±»å®ä¾‹åŒ–"><strong>ç±»å®ä¾‹åŒ–</strong></h3>
<p>ç±»å®ä¾‹åŒ–åŒæ ·ä½¿ç”¨ java å…³é”®å­— â€œnewâ€ï¼Œç±»åå¿…é¡»æ˜¯å…¨é™å®šåï¼Œä½† java.lang åŒ…å†…çš„ç±»å‹é™¤å¤–ï¼Œå¦‚ Stringã€Integerã€‚</p>
<pre><code class="language-java">@Test
public void testConstructorExpression() {
    ExpressionParser parser = new SpelExpressionParser();
    String result1 = parser.parseExpression(&quot;new String('è·¯äººç”²java')&quot;).getValue(String.class);
    System.out.println(result1);

    Date result2 = parser.parseExpression(&quot;new java.util.Date()&quot;).getValue(Date.class);
    System.out.println(result2);
}

</code></pre>
<p>å®ä¾‹åŒ–å®Œå…¨è·Ÿ Java å†…æ–¹å¼ä¸€æ ·ï¼Œè¿è¡Œè¾“å‡º</p>
<pre><code>è·¯äººç”²java
Tue Aug 03 20:22:43 CST 2020

</code></pre>
<h3 id="instanceof-è¡¨è¾¾å¼"><strong>instanceof è¡¨è¾¾å¼</strong></h3>
<p>SpEL æ”¯æŒ instanceof è¿ç®—ç¬¦ï¼Œè·Ÿ Java å†…ä½¿ç”¨åŒä¹‰ï¼›å¦‚ â€œ'haha' instanceof T(String)â€ å°†è¿”å› trueã€‚</p>
<pre><code class="language-java">@Test
public void testInstanceOfExpression() {
    ExpressionParser parser = new SpelExpressionParser();
    Boolean value = parser.parseExpression(&quot;'è·¯äººç”²' instanceof T(String)&quot;).getValue(Boolean.class);
    System.out.println(value);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>true

</code></pre>
<h3 id="å˜é‡å®šä¹‰åŠå¼•ç”¨"><strong>å˜é‡å®šä¹‰åŠå¼•ç”¨</strong></h3>
<p>å˜é‡å®šä¹‰é€šè¿‡ EvaluationContext æ¥å£çš„ setVariable(variableName, value) æ–¹æ³•å®šä¹‰ï¼›åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨<code>&quot;#variableName&quot;</code>å¼•ç”¨ï¼›é™¤äº†å¼•ç”¨è‡ªå®šä¹‰å˜é‡ï¼ŒSpE è¿˜å…è®¸å¼•ç”¨æ ¹å¯¹è±¡åŠå½“å‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä½¿ç”¨<code>&quot;#root&quot;</code>å¼•ç”¨æ ¹å¯¹è±¡ï¼Œä½¿ç”¨<code>&quot;#this&quot;</code>å¼•ç”¨å½“å‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼›</p>
<pre><code class="language-java">@Test
public void testVariableExpression() {
    ExpressionParser parser = new SpelExpressionParser();
    EvaluationContext context = new StandardEvaluationContext();
    context.setVariable(&quot;name&quot;, &quot;è·¯äººç”²java&quot;);
    context.setVariable(&quot;lesson&quot;, &quot;Springç³»åˆ—&quot;);

    //è·å–nameå˜é‡ï¼Œlessonå˜é‡
    String name = parser.parseExpression(&quot;#name&quot;).getValue(context, String.class);
    System.out.println(name);
    String lesson = parser.parseExpression(&quot;#lesson&quot;).getValue(context, String.class);
    System.out.println(lesson);

    //StandardEvaluationContextæ„é€ å™¨ä¼ å…¥rootå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡#rootæ¥è®¿é—®rootå¯¹è±¡
    context = new StandardEvaluationContext(&quot;æˆ‘æ˜¯rootå¯¹è±¡&quot;);
    String rootObj = parser.parseExpression(&quot;#root&quot;).getValue(context, String.class);
    System.out.println(rootObj);

    //#thisç”¨æ¥è®¿é—®å½“å‰ä¸Šçº¿æ–‡ä¸­çš„å¯¹è±¡
    String thisObj = parser.parseExpression(&quot;#this&quot;).getValue(context, String.class);
    System.out.println(thisObj);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>è·¯äººç”²java
Springç³»åˆ—
æˆ‘æ˜¯rootå¯¹è±¡
æˆ‘æ˜¯rootå¯¹è±¡

</code></pre>
<p>ä½¿ç”¨ â€œ#variableâ€ æ¥å¼•ç”¨åœ¨ EvaluationContext å®šä¹‰çš„å˜é‡ï¼›é™¤äº†å¯ä»¥å¼•ç”¨è‡ªå®šä¹‰å˜é‡ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ â€œ#rootâ€ å¼•ç”¨æ ¹å¯¹è±¡ï¼Œâ€œ#thisâ€å¼•ç”¨å½“å‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ­¤å¤„ â€œ#thisâ€ å³æ ¹å¯¹è±¡ã€‚</p>
<h3 id="è‡ªå®šä¹‰å‡½æ•°"><strong>è‡ªå®šä¹‰å‡½æ•°</strong></h3>
<p>ç›®å‰åªæ”¯æŒç±»é™æ€æ–¹æ³•æ³¨å†Œä¸ºè‡ªå®šä¹‰å‡½æ•°ï¼›SpEL ä½¿ç”¨ StandardEvaluationContext çš„ registerFunction æ–¹æ³•è¿›è¡Œæ³¨å†Œè‡ªå®šä¹‰å‡½æ•°ï¼Œå…¶å®å®Œå…¨å¯ä»¥ä½¿ç”¨ setVariable ä»£æ›¿ï¼Œä¸¤è€…å…¶å®æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼›</p>
<pre><code class="language-java">@Test
public void testFunctionExpression() throws SecurityException, NoSuchMethodException {
    //å®šä¹‰2ä¸ªå‡½æ•°,registerFunctionå’ŒsetVariableéƒ½å¯ä»¥ï¼Œä¸è¿‡ä»è¯­ä¹‰ä¸Šé¢æ¥çœ‹ç”¨registerFunctionæ›´æ°å½“
    StandardEvaluationContext context = new StandardEvaluationContext();
    Method parseInt = Integer.class.getDeclaredMethod(&quot;parseInt&quot;, String.class);
    context.registerFunction(&quot;parseInt1&quot;, parseInt);
    context.setVariable(&quot;parseInt2&quot;, parseInt);

    ExpressionParser parser = new SpelExpressionParser();
    System.out.println(parser.parseExpression(&quot;#parseInt1('3')&quot;).getValue(context, int.class));
    System.out.println(parser.parseExpression(&quot;#parseInt2('3')&quot;).getValue(context, int.class));
    
    String expression1 = &quot;#parseInt1('3') == #parseInt2('3')&quot;;
    boolean result1 = parser.parseExpression(expression1).getValue(context, boolean.class);
    System.out.println(result1);
}

</code></pre>
<p>æ­¤å¤„å¯ä»¥çœ‹å‡º â€œregisterFunctionâ€ å’Œâ€œsetVariableâ€éƒ½å¯ä»¥æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°ï¼Œä½†æ˜¯ä¸¤ä¸ªæ–¹æ³•çš„å«ä¹‰ä¸ä¸€æ ·ï¼Œæ¨èä½¿ç”¨ â€œregisterFunctionâ€ æ–¹æ³•æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°ã€‚</p>
<p>è¿è¡Œè¾“å‡º</p>
<pre><code>3
3
true

</code></pre>
<h3 id="è¡¨è¾¾å¼èµ‹å€¼"><strong>è¡¨è¾¾å¼èµ‹å€¼</strong></h3>
<p>ä½¿ç”¨<code>Expression#setValue</code>æ–¹æ³•å¯ä»¥ç»™è¡¨è¾¾å¼èµ‹å€¼</p>
<pre><code class="language-java">@Test
public void testAssignExpression1() {
    Object user = new Object() {
        private String name;

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }

        @Override
        public String toString() {
            return &quot;$classname{&quot; +
                    &quot; + name + '\'' +
                    '}';
        }
    };
    {
        //userä¸ºrootå¯¹è±¡
        ExpressionParser parser = new SpelExpressionParser();
        EvaluationContext context = new StandardEvaluationContext(user);
        parser.parseExpression(&quot;#root.name&quot;).setValue(context, &quot;è·¯äººç”²java&quot;);
        System.out.println(parser.parseExpression(&quot;#root&quot;).getValue(context, user.getClass()));
    }
    {
        //userä¸ºå˜é‡
        ExpressionParser parser = new SpelExpressionParser();
        EvaluationContext context = new StandardEvaluationContext();
        context.setVariable(&quot;user&quot;, user);
        parser.parseExpression(&quot;#user.name&quot;).setValue(context, &quot;è·¯äººç”²java&quot;);
        System.out.println(parser.parseExpression(&quot;#user&quot;).getValue(context, user.getClass()));
    }
}

</code></pre>
<p>è¿è¡Œè¾“å‡º</p>
<pre><code>$classname{name='è·¯äººç”²java'}
$classname{name='è·¯äººç”²java'}

</code></pre>
<h3 id="å¯¹è±¡å±æ€§å­˜å–åŠå®‰å…¨å¯¼èˆªè¡¨è¾¾å¼"><strong>å¯¹è±¡å±æ€§å­˜å–åŠå®‰å…¨å¯¼èˆªè¡¨è¾¾å¼</strong></h3>
<p>å¯¹è±¡å±æ€§è·å–éå¸¸ç®€å•ï¼Œå³ä½¿ç”¨å¦‚ â€œa.property.propertyâ€ è¿™ç§ç‚¹ç¼€å¼è·å–ï¼ŒSpEL å¯¹äºå±æ€§åé¦–å­—æ¯æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼›SpEL è¿˜å¼•å…¥äº† Groovy è¯­è¨€ä¸­çš„å®‰å…¨å¯¼èˆªè¿ç®—ç¬¦â€œ<strong>(å¯¹è±¡ | å±æ€§)?. å±æ€§</strong>â€ï¼Œç”¨æ¥é¿å… â€œ?.â€ å‰è¾¹çš„è¡¨è¾¾å¼ä¸º null æ—¶æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å› nullï¼›ä¿®æ”¹å¯¹è±¡å±æ€§å€¼åˆ™å¯ä»¥é€šè¿‡èµ‹å€¼è¡¨è¾¾å¼æˆ– Expression æ¥å£çš„ setValue æ–¹æ³•ä¿®æ”¹ã€‚</p>
<pre><code class="language-java">public static class Car {
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public String toString() {
        return &quot;Car{&quot; +
                &quot; + name + '\'' +
                '}';
    }
}

public static class User {
    private Car car;

    public Car getCar() {
        return car;
    }

    public void setCar(Car car) {
        this.car = car;
    }

    @Override
    public String toString() {
        return &quot;User{&quot; +
                &quot;car=&quot; + car +
                '}';
    }
}

@Test
public void test5() {
    User user = new User();
    EvaluationContext context = new StandardEvaluationContext();
    context.setVariable(&quot;user&quot;, user);

    ExpressionParser parser = new SpelExpressionParser();
    //ä½¿ç”¨.ç¬¦å·ï¼Œè®¿é—®user.car.nameä¼šæŠ¥é”™ï¼ŒåŸå› ï¼šuser.carä¸ºç©º
    try {
        System.out.println(parser.parseExpression(&quot;#user.car.name&quot;).getValue(context, String.class));
    } catch (EvaluationException | ParseException e) {
        System.out.println(&quot;å‡ºé”™äº†ï¼š&quot; + e.getMessage());
    }
    //ä½¿ç”¨å®‰å…¨è®¿é—®ç¬¦å·?.ï¼Œå¯ä»¥è§„é¿nullé”™è¯¯
    System.out.println(parser.parseExpression(&quot;#user?.car?.name&quot;).getValue(context, String.class));

    Car car = new Car();
    car.setName(&quot;ä¿æ—¶æ·&quot;);
    user.setCar(car);

    System.out.println(parser.parseExpression(&quot;#user?.car?.toString()&quot;).getValue(context, String.class));
}

</code></pre>
<p>è¿è¡Œè¾“å‡º</p>
<pre><code>å‡ºé”™äº†ï¼šEL1007E: Property or field 'name' cannot be found on null
null
Car{name='ä¿æ—¶æ·'}

</code></pre>
<h3 id="å¯¹è±¡æ–¹æ³•è°ƒç”¨"><strong>å¯¹è±¡æ–¹æ³•è°ƒç”¨</strong></h3>
<p>å¯¹è±¡æ–¹æ³•è°ƒç”¨æ›´ç®€å•ï¼Œè·Ÿ Java è¯­æ³•ä¸€æ ·ï¼›å¦‚ â€œ'haha'.substring(2,4)â€ å°†è¿”å›â€œhaâ€ï¼›è€Œå¯¹äºæ ¹å¯¹è±¡å¯ä»¥ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼›</p>
<h3 id="bean-å¼•ç”¨"><strong>Bean å¼•ç”¨</strong></h3>
<p>SpEL æ”¯æŒä½¿ç”¨ â€œ@â€ ç¬¦å·æ¥å¼•ç”¨ Beanï¼Œåœ¨å¼•ç”¨ Bean æ—¶éœ€è¦ä½¿ç”¨ BeanResolver æ¥å£å®ç°æ¥æŸ¥æ‰¾ Beanï¼ŒSpring æä¾› BeanFactoryResolver å®ç°ã€‚</p>
<pre><code class="language-java">@Test
public void test6() {
    DefaultListableBeanFactory factory = new DefaultListableBeanFactory();
    User user = new User();
    Car car = new Car();
    car.setName(&quot;ä¿æ—¶æ·&quot;);
    user.setCar(car);
    factory.registerSingleton(&quot;user&quot;, user);

    StandardEvaluationContext context = new StandardEvaluationContext();
    context.setBeanResolver(new BeanFactoryResolver(factory));

    ExpressionParser parser = new SpelExpressionParser();
    User userBean = parser.parseExpression(&quot;@user&quot;).getValue(context, User.class);
    System.out.println(userBean);
    System.out.println(userBean == factory.getBean(&quot;user&quot;));
}

</code></pre>
<p>è¿è¡Œè¾“å‡º</p>
<pre><code>User{car=Car{name='ä¿æ—¶æ·'}}
true

</code></pre>
<h3 id="é›†åˆç›¸å…³è¡¨è¾¾å¼"><strong>é›†åˆç›¸å…³è¡¨è¾¾å¼</strong></h3>
<h3 id="å†…è”-list"><strong>å†…è” List</strong></h3>
<p>ä» Spring3.0.4 å¼€å§‹æ”¯æŒå†…è” Listï¼Œä½¿ç”¨ {è¡¨è¾¾å¼ï¼Œâ€¦â€¦} å®šä¹‰å†…è” Listï¼Œå¦‚ â€œ{1,2,3}â€ å°†è¿”å›ä¸€ä¸ªæ•´å‹çš„ ArrayListï¼Œè€Œ â€œ{}â€ å°†è¿”å›ç©ºçš„ Listï¼Œå¯¹äºå­—é¢é‡è¡¨è¾¾å¼åˆ—è¡¨ï¼ŒSpEL ä¼šä½¿ç”¨ java.util.Collections.unmodifiableList æ–¹æ³•å°†åˆ—è¡¨è®¾ç½®ä¸ºä¸å¯ä¿®æ”¹ã€‚</p>
<pre><code class="language-java">@Test
public void test7() {
    ExpressionParser parser = new SpelExpressionParser();
    //å°†è¿”å›ä¸å¯ä¿®æ”¹çš„ç©ºList
    List&lt;Integer&gt; result2 = parser.parseExpression(&quot;{}&quot;).getValue(List.class);
    //å¯¹äºå­—é¢é‡åˆ—è¡¨ä¹Ÿå°†è¿”å›ä¸å¯ä¿®æ”¹çš„List
    List&lt;Integer&gt; result1 = parser.parseExpression(&quot;{1,2,3}&quot;).getValue(List.class);
    Assert.assertEquals(new Integer(1), result1.get(0));
    try {
        result1.set(0, 2);
    } catch (Exception e) {
        e.printStackTrace();
    }
    //å¯¹äºåˆ—è¡¨ä¸­åªè¦æœ‰ä¸€ä¸ªä¸æ˜¯å­—é¢é‡è¡¨è¾¾å¼ï¼Œå°†åªè¿”å›åŸå§‹Listï¼Œ
    //ä¸ä¼šè¿›è¡Œä¸å¯ä¿®æ”¹å¤„ç†
    String expression3 = &quot;{{1+2,2+4},{3,4+4}}&quot;;
    List&lt;List&lt;Integer&gt;&gt; result3 = parser.parseExpression(expression3).getValue(List.class);
    result3.get(0).set(0, 1);
    System.out.println(result3);
    //å£°æ˜äºŒç»´æ•°ç»„å¹¶åˆå§‹åŒ–
    int[] result4 = parser.parseExpression(&quot;new int[2]{1,2}&quot;).getValue(int[].class);
    System.out.println(result4[1]);
    //å®šä¹‰ä¸€ç»´æ•°ç»„å¹¶åˆå§‹åŒ–
    int[] result5 = parser.parseExpression(&quot;new int[1]&quot;).getValue(int[].class);
    System.out.println(result5[0]);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>java.lang.UnsupportedOperationException
 at java.util.Collections$UnmodifiableList.set(Collections.java:1311)
 at com.javacode2018.spel.SpelTest.test7(SpelTest.java:315)
[[1, 6], [3, 8]]
2
0

</code></pre>
<h3 id="å†…è”æ•°ç»„"><strong>å†…è”æ•°ç»„</strong></h3>
<p>å’Œ Java æ•°ç»„å®šä¹‰ç±»ä¼¼ï¼Œåªæ˜¯åœ¨å®šä¹‰æ—¶è¿›è¡Œå¤šç»´æ•°ç»„åˆå§‹åŒ–ã€‚</p>
<pre><code class="language-java">int[][][] result4 = parser.parseExpression(&quot;new int[1][2][3]{{1}{2}{3}}&quot;).getValue(int[][][].class);

</code></pre>
<h3 id="é›†åˆå­—å…¸å…ƒç´ è®¿é—®"><strong>é›†åˆï¼Œå­—å…¸å…ƒç´ è®¿é—®</strong></h3>
<p>SpEL ç›®å‰æ”¯æŒæ‰€æœ‰é›†åˆç±»å‹å’Œå­—å…¸ç±»å‹çš„å…ƒç´ è®¿é—®ï¼Œä½¿ç”¨ â€œé›†åˆ[ç´¢å¼•]â€ è®¿é—®é›†åˆå…ƒç´ ï¼Œä½¿ç”¨ â€œmap[key]â€ è®¿é—®å­—å…¸å…ƒç´ ï¼›</p>
<pre><code class="language-java">//SpELå†…è”Listè®¿é—®  
int result1 = parser.parseExpression(&quot;{1,2,3}[0]&quot;).getValue(int.class);  

//SpELç›®å‰æ”¯æŒæ‰€æœ‰é›†åˆç±»å‹çš„è®¿é—®  
Collection&lt;Integer&gt; collection = new HashSet&lt;Integer&gt;();  
collection.add(1);  
collection.add(2);  

EvaluationContext context2 = new StandardEvaluationContext();  
context2.setVariable(&quot;collection&quot;, collection);  
int result2 = parser.parseExpression(&quot;#collection[1]&quot;).getValue(context2, int.class);  


//SpELå¯¹Mapå­—å…¸å…ƒç´ è®¿é—®çš„æ”¯æŒ  
Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();  
map.put(&quot;a&quot;, 1);  

EvaluationContext context3 = new StandardEvaluationContext();  
context3.setVariable(&quot;map&quot;, map);  
int result3 = parser.parseExpression(&quot;#map['a']&quot;).getValue(context3, int.class);  

</code></pre>
<h3 id="åˆ—è¡¨å­—å…¸æ•°ç»„å…ƒç´ ä¿®æ”¹"><strong>åˆ—è¡¨ï¼Œå­—å…¸ï¼Œæ•°ç»„å…ƒç´ ä¿®æ”¹</strong></h3>
<p>å¯ä»¥ä½¿ç”¨èµ‹å€¼è¡¨è¾¾å¼æˆ– Expression æ¥å£çš„ setValue æ–¹æ³•ä¿®æ”¹ï¼›</p>
<pre><code class="language-java">@Test
public void test8() {
    ExpressionParser parser = new SpelExpressionParser();

    //ä¿®æ”¹listå…ƒç´ å€¼
    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();
    list.add(1);
    list.add(2);

    EvaluationContext context1 = new StandardEvaluationContext();
    context1.setVariable(&quot;collection&quot;, list);
    parser.parseExpression(&quot;#collection[1]&quot;).setValue(context1, 4);
    int result1 = parser.parseExpression(&quot;#collection[1]&quot;).getValue(context1, int.class);
    System.out.println(result1);

    //ä¿®æ”¹mapå…ƒç´ å€¼
    Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();
    map.put(&quot;a&quot;, 1);
    EvaluationContext context2 = new StandardEvaluationContext();
    context2.setVariable(&quot;map&quot;, map);
    parser.parseExpression(&quot;#map['a']&quot;).setValue(context2, 4);
    Integer result2 = parser.parseExpression(&quot;#map['a']&quot;).getValue(context2, int.class);
    System.out.println(result2);
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>4
4

</code></pre>
<h3 id="é›†åˆæŠ•å½±"><strong>é›†åˆæŠ•å½±</strong></h3>
<p>åœ¨ SQL ä¸­æŠ•å½±æŒ‡ä»è¡¨ä¸­é€‰æ‹©å‡ºåˆ—ï¼Œè€Œåœ¨ SpEL æŒ‡æ ¹æ®é›†åˆä¸­çš„å…ƒç´ ä¸­é€šè¿‡é€‰æ‹©æ¥æ„é€ å¦ä¸€ä¸ªé›†åˆï¼Œè¯¥é›†åˆå’ŒåŸé›†åˆå…·æœ‰ç›¸åŒæ•°é‡çš„å…ƒç´ ï¼›SpEL ä½¿ç”¨ â€œï¼ˆlist|mapï¼‰.![æŠ•å½±è¡¨è¾¾å¼]â€ æ¥è¿›è¡ŒæŠ•å½±è¿ç®—ï¼š</p>
<pre><code class="language-java">@Test
public void test9() {
    ExpressionParser parser = new SpelExpressionParser();

    //1.æµ‹è¯•é›†åˆæˆ–æ•°ç»„
    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();
    list.add(4);
    list.add(5);
    EvaluationContext context1 = new StandardEvaluationContext();
    context1.setVariable(&quot;list&quot;, list);
    Collection&lt;Integer&gt; result1 = parser.parseExpression(&quot;#list.![#this+1]&quot;).getValue(context1, Collection.class);
    result1.forEach(System.out::println);

    System.out.println(&quot;------------&quot;);
    //2.æµ‹è¯•å­—å…¸
    Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();
    map.put(&quot;a&quot;, 1);
    map.put(&quot;b&quot;, 2);
    EvaluationContext context2 = new StandardEvaluationContext();
    context2.setVariable(&quot;map&quot;, map);
    List&lt;Integer&gt; result2 = parser.parseExpression(&quot;#map.![value+1]&quot;).getValue(context2, List.class);
    result2.forEach(System.out::println);
}

</code></pre>
<p>å¯¹äºé›†åˆæˆ–æ•°ç»„ä½¿ç”¨å¦‚ä¸Šè¡¨è¾¾å¼è¿›è¡ŒæŠ•å½±è¿ç®—ï¼Œå…¶ä¸­æŠ•å½±è¡¨è¾¾å¼ä¸­ â€œ#thisâ€ ä»£è¡¨æ¯ä¸ªé›†åˆæˆ–æ•°ç»„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨æ¯”å¦‚ â€œ#this.propertyâ€ æ¥è·å–é›†åˆå…ƒç´ çš„å±æ€§ï¼Œå…¶ä¸­ â€œ#thisâ€ å¯ä»¥çœç•¥ã€‚</p>
<p>Map æŠ•å½±æœ€ç»ˆåªèƒ½å¾—åˆ° List ç»“æœï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œå¯¹äºæŠ•å½±è¡¨è¾¾å¼ä¸­çš„ â€œ#thisâ€ å°†æ˜¯ Map.Entryï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ â€œvalueâ€ æ¥è·å–å€¼ï¼Œä½¿ç”¨ â€œkeyâ€ æ¥è·å–é”®ã€‚</p>
<h3 id="é›†åˆé€‰æ‹©"><strong>é›†åˆé€‰æ‹©</strong></h3>
<p>åœ¨ SQL ä¸­æŒ‡ä½¿ç”¨ select è¿›è¡Œé€‰æ‹©è¡Œæ•°æ®ï¼Œè€Œåœ¨ SpEL æŒ‡æ ¹æ®åŸé›†åˆé€šè¿‡æ¡ä»¶è¡¨è¾¾å¼é€‰æ‹©å‡ºæ»¡è¶³æ¡ä»¶çš„å…ƒç´ å¹¶æ„é€ ä¸ºæ–°çš„é›†åˆï¼ŒSpEL ä½¿ç”¨ â€œ(list|map).?[é€‰æ‹©è¡¨è¾¾å¼]â€ï¼Œå…¶ä¸­é€‰æ‹©è¡¨è¾¾å¼ç»“æœå¿…é¡»æ˜¯ boolean ç±»å‹ï¼Œå¦‚æœ true åˆ™é€‰æ‹©çš„å…ƒç´ å°†æ·»åŠ åˆ°æ–°é›†åˆä¸­ï¼Œfalse å°†ä¸æ·»åŠ åˆ°æ–°é›†åˆä¸­ã€‚</p>
<pre><code class="language-java">@Test
public void test10() {
    ExpressionParser parser = new SpelExpressionParser();

    //1.æµ‹è¯•é›†åˆæˆ–æ•°ç»„
    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();
    list.add(1);
    list.add(4);
    list.add(5);
    list.add(7);
    EvaluationContext context1 = new StandardEvaluationContext();
    context1.setVariable(&quot;list&quot;, list);
    Collection&lt;Integer&gt; result1 = parser.parseExpression(&quot;#list.?[#this&gt;4]&quot;).getValue(context1, Collection.class);
    result1.forEach(System.out::println);

    System.out.println(&quot;------------&quot;);
    
}

</code></pre>
<p>è¾“å‡º</p>
<pre><code>5
7

</code></pre>
<p>å¯¹äºé›†åˆæˆ–æ•°ç»„é€‰æ‹©ï¼Œå¦‚ â€œ#collection.?[#this&gt;4]â€ å°†é€‰æ‹©å‡ºé›†åˆå…ƒç´ å€¼å¤§äº 4 çš„æ‰€æœ‰å…ƒç´ ã€‚é€‰æ‹©è¡¨è¾¾å¼å¿…é¡»è¿”å›å¸ƒå°”ç±»å‹ï¼Œä½¿ç”¨ â€œ#thisâ€ è¡¨ç¤ºå½“å‰å…ƒç´ ã€‚</p>
<pre><code class="language-java">//2.æµ‹è¯•å­—å…¸
Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();
map.put(&quot;a&quot;, 1);
map.put(&quot;b&quot;, 2);
map.put(&quot;c&quot;, 3);
EvaluationContext context2 = new StandardEvaluationContext();
context2.setVariable(&quot;map&quot;, map);
Map&lt;String, Integer&gt; result2 = parser.parseExpression(&quot;#map.?[key!='a']&quot;).getValue(context2, Map.class);
result2.forEach((key, value) -&gt; {
    System.out.println(key + &quot;:&quot; + value);
});
System.out.println(&quot;------------&quot;);
List&lt;Integer&gt; result3 = parser.parseExpression(&quot;#map.?[key!='a'].![value+1]&quot;).getValue(context2, List.class);
result3.forEach(System.out::println);

</code></pre>
<p>è¾“å‡º</p>
<pre><code>b:2
c:3
------------
3
4

</code></pre>
<p>å¯¹äºå­—å…¸é€‰æ‹©ï¼Œå¦‚ â€œ#map.?[#this.key != 'a']â€ å°†é€‰æ‹©é”®å€¼ä¸ç­‰äºâ€aâ€çš„ï¼Œå…¶ä¸­é€‰æ‹©è¡¨è¾¾å¼ä¸­ â€œ#thisâ€ æ˜¯ Map.Entry ç±»å‹ï¼Œè€Œæœ€ç»ˆç»“æœè¿˜æ˜¯ Mapï¼Œè¿™ç‚¹å’ŒæŠ•å½±ä¸åŒï¼›é›†åˆé€‰æ‹©å’ŒæŠ•å½±å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ â€œ#map.?[key != 'a'].![value+1]â€ å°†é¦–å…ˆé€‰æ‹©é”®å€¼ä¸ç­‰äºâ€aâ€çš„ï¼Œç„¶ååœ¨é€‰å‡ºçš„ Map ä¸­å†è¿›è¡Œ â€œvalue+1â€ çš„æŠ•å½±ã€‚</p>
<h3 id="è¡¨è¾¾å¼æ¨¡æ¿"><strong>è¡¨è¾¾å¼æ¨¡æ¿</strong></h3>
<p>æ¨¡æ¿è¡¨è¾¾å¼å°±æ˜¯ç”±å­—é¢é‡ä¸ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼å—ç»„æˆã€‚æ¯ä¸ªè¡¨è¾¾å¼å—ç”± â€œå‰ç¼€ + è¡¨è¾¾å¼ + åç¼€â€ å½¢å¼ç»„æˆï¼Œå¦‚ â€œ${1+2}â€ å³è¡¨è¾¾å¼å—ã€‚åœ¨å‰è¾¹æˆ‘ä»¬å·²ç»ä»‹ç»äº†ä½¿ç”¨ ParserContext æ¥å£å®ç°æ¥å®šä¹‰è¡¨è¾¾å¼æ˜¯å¦æ˜¯æ¨¡æ¿åŠå‰ç¼€å’Œåç¼€å®šä¹‰ã€‚åœ¨æ­¤å°±ä¸å¤šä»‹ç»äº†ï¼Œå¦‚ â€œError ${#v0} ${#v1}â€ è¡¨è¾¾å¼è¡¨ç¤ºç”±å­—é¢é‡ â€œError â€ã€æ¨¡æ¿è¡¨è¾¾å¼â€œ#v0â€ã€æ¨¡æ¿è¡¨è¾¾å¼â€œ#v1â€ ç»„æˆï¼Œå…¶ä¸­ v0 å’Œ v1 è¡¨ç¤ºè‡ªå®šä¹‰å˜é‡ï¼Œéœ€è¦åœ¨ä¸Šä¸‹æ–‡å®šä¹‰ã€‚</p>
<p>è§£æè¡¨è¾¾å¼çš„æ—¶å€™éœ€è¦æŒ‡å®šæ¨¡æ¿ï¼Œæ¨¡æ¿é€šè¿‡<code>ParserContext</code>æ¥å£æ¥å®šä¹‰</p>
<pre><code class="language-java">public interface ParserContext {
 //æ˜¯å¦æ˜¯æ¨¡æ¿
 boolean isTemplate();
 //æ¨¡æ¿è¡¨è¾¾å¼å‰ç¼€
 String getExpressionPrefix();
 //æ¨¡æ¿è¡¨è¾¾å¼åç¼€
 String getExpressionSuffix();
}

</code></pre>
<p>æœ‰ä¸ªå­ç±»ï¼Œæˆ‘ä»¬ç›´æ¥å¯ä»¥æ‹¿æ¥ç”¨ï¼š<code>TemplateParserContext</code>ã€‚</p>
<pre><code class="language-java">@Test
public void test11() {
    //åˆ›å»ºè§£æå™¨
    SpelExpressionParser parser = new SpelExpressionParser();
    //åˆ›å»ºè§£æå™¨ä¸Šä¸‹æ–‡
    ParserContext context = new TemplateParserContext(&quot;%{&quot;, &quot;}&quot;);
    Expression expression = parser.parseExpression(&quot;ä½ å¥½:%{#name},æˆ‘ä»¬æ­£åœ¨å­¦ä¹ :%{#lesson}&quot;, context);

    //åˆ›å»ºè¡¨è¾¾å¼è®¡ç®—ä¸Šä¸‹æ–‡
    EvaluationContext evaluationContext = new StandardEvaluationContext();
    evaluationContext.setVariable(&quot;name&quot;, &quot;è·¯äººç”²java&quot;);
    evaluationContext.setVariable(&quot;lesson&quot;, &quot;springé«˜æ‰‹ç³»åˆ—!&quot;);
    //è·å–å€¼
    String value = expression.getValue(evaluationContext, String.class);
    System.out.println(value);
}

</code></pre>
<p>è¿è¡Œè¾“å‡º</p>
<pre><code>ä½ å¥½:è·¯äººç”²java,æˆ‘ä»¬æ­£åœ¨å­¦ä¹ :springé«˜æ‰‹ç³»åˆ—!

</code></pre>
<h2 id="åœ¨-bean-å®šä¹‰ä¸­ä½¿ç”¨-spel-è¡¨è¾¾å¼"><strong>åœ¨ Bean å®šä¹‰ä¸­ä½¿ç”¨ spel è¡¨è¾¾å¼</strong></h2>
<h3 id="xml-é£æ ¼çš„é…ç½®"><strong>xml é£æ ¼çš„é…ç½®</strong></h3>
<p>SpEL æ”¯æŒåœ¨ Bean å®šä¹‰æ—¶æ³¨å…¥ï¼Œé»˜è®¤ä½¿ç”¨ â€œ#{SpEL è¡¨è¾¾å¼}â€ è¡¨ç¤ºï¼Œå…¶ä¸­ â€œ#rootâ€ æ ¹å¯¹è±¡é»˜è®¤å¯ä»¥è®¤ä¸ºæ˜¯ ApplicationContextï¼Œåªæœ‰ ApplicationContext å®ç°é»˜è®¤æ”¯æŒ SpELï¼Œè·å–æ ¹å¯¹è±¡å±æ€§å…¶å®æ˜¯è·å–å®¹å™¨ä¸­çš„ Beanã€‚</p>
<p>å¦‚ï¼š</p>
<pre><code class="language-xml">&lt;bean&gt;  
    &lt;constructor-arg value=&quot;#{' World!'}&quot;/&gt;  
&lt;/bean&gt;  

&lt;bean&gt;  
    &lt;constructor-arg value=&quot;#{'Hello'}#{world}&quot;/&gt;  
&lt;/bean&gt;    

&lt;bean&gt;  
    &lt;constructor-arg value=&quot;#{'Hello' + world}&quot;/&gt;
&lt;/bean&gt;  

&lt;bean&gt;  
    &lt;constructor-arg value=&quot;#{'Hello' + @world}&quot;/&gt;  
&lt;/bean&gt;

</code></pre>
<p>æ¨¡æ¿é»˜è®¤ä»¥å‰ç¼€ â€œ#{â€ å¼€å¤´ï¼Œä»¥åç¼€ â€œ}â€ ç»“å°¾ï¼Œä¸”ä¸å…è®¸åµŒå¥—ï¼Œå¦‚ â€œ#{'Hello'#{world}}â€ é”™è¯¯ï¼Œå¦‚ â€œ#{'Hello' + world}â€ ä¸­â€œworldâ€é»˜è®¤è§£æä¸º Beanã€‚å½“ç„¶å¯ä»¥ä½¿ç”¨ â€œ@beanâ€ å¼•ç”¨äº†ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œé™¤äº† XML é…ç½®æ–¹å¼ï¼ŒSpring è¿˜æä¾›ä¸€ç§æ³¨è§£æ–¹å¼ @Valueï¼Œæ¥ç€å¾€ä¸‹çœ‹å§ã€‚</p>
<h3 id="æ³¨è§£é£æ ¼çš„é…ç½®"><strong>æ³¨è§£é£æ ¼çš„é…ç½®</strong></h3>
<p>åŸºäºæ³¨è§£é£æ ¼çš„ SpEL é…ç½®ä¹Ÿéå¸¸ç®€å•ï¼Œä½¿ç”¨ @Value æ³¨è§£æ¥æŒ‡å®š SpEL è¡¨è¾¾å¼ï¼Œè¯¥æ³¨è§£å¯ä»¥æ”¾åˆ°å­—æ®µã€æ–¹æ³•åŠæ–¹æ³•å‚æ•°ä¸Šã€‚</p>
<p>æµ‹è¯• Bean ç±»å¦‚ä¸‹ï¼Œä½¿ç”¨ @Value æ¥æŒ‡å®š SpEL è¡¨è¾¾å¼ï¼š</p>
<pre><code class="language-java">public class SpELBean {  
    @Value(&quot;#{'Hello' + world}&quot;)  
    private String value;  
}

</code></pre>
<h3 id="åœ¨-bean-å®šä¹‰ä¸­-spel-çš„é—®é¢˜"><strong>åœ¨ Bean å®šä¹‰ä¸­ SpEL çš„é—®é¢˜</strong></h3>
<p>å¦‚æœæœ‰åŒå­¦é—® â€œ#{æˆ‘ä¸æ˜¯ SpEL è¡¨è¾¾å¼}â€ ä¸æ˜¯ SpEL è¡¨è¾¾å¼ï¼Œè€Œæ˜¯å…¬å¸å†…éƒ¨çš„æ¨¡æ¿ï¼Œæƒ³æ¢ä¸ªå‰ç¼€å’Œåç¼€è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ä½¿ç”¨ BeanFactoryPostProcessor æ¥å£æä¾› postProcessBeanFactory å›è°ƒæ–¹æ³•ï¼Œå®ƒæ˜¯åœ¨ IoC å®¹å™¨åˆ›å»ºå¥½ä½†è¿˜æœªè¿›è¡Œä»»ä½• Bean åˆå§‹åŒ–æ—¶è¢« ApplicationContext å®ç°è°ƒç”¨ï¼Œå› æ­¤åœ¨è¿™ä¸ªé˜¶æ®µæŠŠ SpEL å‰ç¼€åŠåç¼€ä¿®æ”¹æ‰æ˜¯å®‰å…¨çš„ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">package com.javacode2018.spel.test1;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanExpressionResolver;
import org.springframework.beans.factory.config.BeanFactoryPostProcessor;
import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;
import org.springframework.context.expression.StandardBeanExpressionResolver;
import org.springframework.stereotype.Component;

@Component
public class SpelBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
        BeanExpressionResolver beanExpressionResolver = beanFactory.getBeanExpressionResolver();
        if (beanExpressionResolver instanceof StandardBeanExpressionResolver) {
            StandardBeanExpressionResolver resolver = (StandardBeanExpressionResolver) beanExpressionResolver;
            resolver.setExpressionPrefix(&quot;%{&quot;);
            resolver.setExpressionSuffix(&quot;}&quot;);
        }
    }
}

</code></pre>
<p>ä¸Šæµ‹è¯•ä»£ç </p>
<pre><code class="language-java">package com.javacode2018.spel.test1;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

@Component
public class LessonModel {
    @Value(&quot;ä½ å¥½,%{@name},%{@msg}&quot;)
    private String desc;

    @Override
    public String toString() {
        return &quot;LessonModel{&quot; +
                &quot;desc='&quot; + desc + '\'' +
                '}';
    }
}

</code></pre>
<p>@nameï¼šå®¹å™¨ä¸­ name çš„ bean</p>
<p>@msgï¼šå®¹å™¨ä¸­ msg çš„ bean</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥ä¸ªé…ç½®ç±»ï¼Œé¡ºä¾¿å®šä¹‰ name å’Œ msg è¿™ 2 ä¸ª beanï¼Œé¡ºä¾¿æ‰«æä¸Šé¢ 2 ä¸ªé…ç½®ç±»</p>
<pre><code class="language-java">package com.javacode2018.spel.test1;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;

@ComponentScan
@Configuration
public class MainConfig {
    @Bean
    public String name() {
        return &quot;è·¯ç²‰&quot;;
    }

    @Bean
    public String msg() {
        return &quot;æ¬¢è¿å’Œæˆ‘ä¸€èµ·å­¦ä¹ javaå„ç§æŠ€æœ¯ï¼&quot;;
    }
}

</code></pre>
<p>æµ‹è¯•ç”¨ä¾‹</p>
<pre><code class="language-java">@Test
public void test12() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext();
    context.register(MainConfig.class);
    context.refresh();
    LessonModel lessonModel = context.getBean(LessonModel.class);
    System.out.println(lessonModel);
}

</code></pre>
<p>è¿è¡Œè¾“å‡º</p>
<pre><code>LessonModel{desc='ä½ å¥½,è·¯ç²‰,æ¬¢è¿å’Œæˆ‘ä¸€èµ·å­¦ä¹ javaå„ç§æŠ€æœ¯ï¼'}

</code></pre>
<h2 id="æ€»ç»“"><strong>æ€»ç»“</strong></h2>
<ol>
<li>Spel åŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒå¼ºå¤§çš„ï¼Œå¯ä»¥è„±ç¦» spring ç¯å¢ƒç‹¬ç«‹è¿è¡Œ</li>
<li>spel å¯ä»¥ç”¨åœ¨ä¸€äº›åŠ¨æ€è§„åˆ™çš„åŒ¹é…æ–¹é¢ï¼Œæ¯”å¦‚ç›‘æ§ç³»ç»Ÿä¸­ç›‘æ§è§„åˆ™çš„åŠ¨æ€åŒ¹é…ï¼›å…¶ä»–çš„ä¸€äº›æ¡ä»¶åŠ¨æ€åˆ¤æ–­ç­‰ç­‰</li>
<li>æœ¬æ–‡å†…å®¹æ¯”è¾ƒé•¿ï¼Œå»ºè®®å¤§å®¶æŠŠæ¡ˆä¾‹éƒ½æ•²ä¸€éï¼Œå¯ä»¥è®¾ç½®ä¸€äº›æ–­ç‚¹å»ç ”ç©¶ä¸€ä¸‹æºç ï¼Œæœ‰é—®é¢˜çš„ï¼Œæ¬¢è¿å¤§å®¶ç•™è¨€äº¤æµã€‚</li>
</ol>
<h2 id="æ¡ˆä¾‹æºç "><strong>æ¡ˆä¾‹æºç </strong></h2>
<pre><code>https://gitee.com/javacode2018/spring-series
</code></pre>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#spel-%E6%A6%82%E8%BF%B0"><strong>Spel æ¦‚è¿°</strong></a></li>
<li><a href="#spel-%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88"><strong>Spel èƒ½å¹²ä»€ä¹ˆ?</strong></a></li>
<li><a href="#spel-%E5%9F%BA%E7%A1%80"><strong>SpEL åŸºç¡€</strong></a>
<ul>
<li><a href="#helloworld"><strong>HelloWorld</strong></a></li>
<li><a href="#spel-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%8E%A5%E5%8F%A3"><strong>SpEL åŸç†åŠæ¥å£</strong></a></li>
<li><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><strong>å·¥ä½œåŸç†</strong></a></li>
<li><a href="#expressionparser-%E6%8E%A5%E5%8F%A3"><strong>ExpressionParser æ¥å£</strong></a></li>
<li><a href="#evaluationcontext-%E6%8E%A5%E5%8F%A3"><strong>EvaluationContext æ¥å£</strong></a></li>
<li><a href="#expression-%E6%8E%A5%E5%8F%A3"><strong>Expression æ¥å£</strong></a></li>
</ul>
</li>
<li><a href="#spel-%E8%AF%AD%E6%B3%95"><strong>SpEL è¯­æ³•</strong></a>
<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>åŸºæœ¬è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E5%AD%97%E9%9D%A2%E9%87%8F%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>å­—é¢é‡è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>ç®—æ•°è¿ç®—è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E5%85%B3%E7%B3%BB%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>å…³ç³»è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>é€»è¾‘è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%8F%8A%E6%88%AA%E5%8F%96%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>å­—ç¬¦ä¸²è¿æ¥åŠæˆªå–è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97"><strong>ä¸‰ç›®è¿ç®—</strong></a></li>
<li><a href="#elivis-%E8%BF%90%E7%AE%97%E7%AC%A6"><strong>Elivis è¿ç®—ç¬¦</strong></a></li>
<li><a href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>æ­£åˆ™è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E6%8B%AC%E5%8F%B7%E4%BC%98%E5%85%88%E7%BA%A7%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>æ‹¬å·ä¼˜å…ˆçº§è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E7%B1%BB%E7%9B%B8%E5%85%B3%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>ç±»ç›¸å…³è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E7%B1%BB%E7%B1%BB%E5%9E%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>ç±»ç±»å‹è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E7%B1%BB%E5%AE%9E%E4%BE%8B%E5%8C%96"><strong>ç±»å®ä¾‹åŒ–</strong></a></li>
<li><a href="#instanceof-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>instanceof è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%BC%95%E7%94%A8"><strong>å˜é‡å®šä¹‰åŠå¼•ç”¨</strong></a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><strong>è‡ªå®šä¹‰å‡½æ•°</strong></a></li>
<li><a href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%B5%8B%E5%80%BC"><strong>è¡¨è¾¾å¼èµ‹å€¼</strong></a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E5%AD%98%E5%8F%96%E5%8F%8A%E5%AE%89%E5%85%A8%E5%AF%BC%E8%88%AA%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>å¯¹è±¡å±æ€§å­˜å–åŠå®‰å…¨å¯¼èˆªè¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><strong>å¯¹è±¡æ–¹æ³•è°ƒç”¨</strong></a></li>
<li><a href="#bean-%E5%BC%95%E7%94%A8"><strong>Bean å¼•ç”¨</strong></a></li>
<li><a href="#%E9%9B%86%E5%90%88%E7%9B%B8%E5%85%B3%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>é›†åˆç›¸å…³è¡¨è¾¾å¼</strong></a></li>
<li><a href="#%E5%86%85%E8%81%94-list"><strong>å†…è” List</strong></a></li>
<li><a href="#%E5%86%85%E8%81%94%E6%95%B0%E7%BB%84"><strong>å†…è”æ•°ç»„</strong></a></li>
<li><a href="#%E9%9B%86%E5%90%88%E5%AD%97%E5%85%B8%E5%85%83%E7%B4%A0%E8%AE%BF%E9%97%AE"><strong>é›†åˆï¼Œå­—å…¸å…ƒç´ è®¿é—®</strong></a></li>
<li><a href="#%E5%88%97%E8%A1%A8%E5%AD%97%E5%85%B8%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0%E4%BF%AE%E6%94%B9"><strong>åˆ—è¡¨ï¼Œå­—å…¸ï¼Œæ•°ç»„å…ƒç´ ä¿®æ”¹</strong></a></li>
<li><a href="#%E9%9B%86%E5%90%88%E6%8A%95%E5%BD%B1"><strong>é›†åˆæŠ•å½±</strong></a></li>
<li><a href="#%E9%9B%86%E5%90%88%E9%80%89%E6%8B%A9"><strong>é›†åˆé€‰æ‹©</strong></a></li>
<li><a href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E6%9D%BF"><strong>è¡¨è¾¾å¼æ¨¡æ¿</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8-bean-%E5%AE%9A%E4%B9%89%E4%B8%AD%E4%BD%BF%E7%94%A8-spel-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><strong>åœ¨ Bean å®šä¹‰ä¸­ä½¿ç”¨ spel è¡¨è¾¾å¼</strong></a>
<ul>
<li><a href="#xml-%E9%A3%8E%E6%A0%BC%E7%9A%84%E9%85%8D%E7%BD%AE"><strong>xml é£æ ¼çš„é…ç½®</strong></a></li>
<li><a href="#%E6%B3%A8%E8%A7%A3%E9%A3%8E%E6%A0%BC%E7%9A%84%E9%85%8D%E7%BD%AE"><strong>æ³¨è§£é£æ ¼çš„é…ç½®</strong></a></li>
<li><a href="#%E5%9C%A8-bean-%E5%AE%9A%E4%B9%89%E4%B8%AD-spel-%E7%9A%84%E9%97%AE%E9%A2%98"><strong>åœ¨ Bean å®šä¹‰ä¸­ SpEL çš„é—®é¢˜</strong></a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93"><strong>æ€»ç»“</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E6%BA%90%E7%A0%81"><strong>æ¡ˆä¾‹æºç </strong></a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://xuyj1111.github.io/Kj_kWSjDE/">
              <h3 class="post-title">
                ã€è½¬è½½ã€‘jackson çš„å‡ ä¸ªæ³¨è§£
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  
  <a class="rss" href="https://xuyj1111.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>



    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'ot2L3hKJVxTAXnr1VQt7wm70-gzGzoHsz',
            appKey: 'BjaYGo2m6zV3mCvxGLGsDP5V'
        })
    </script>



  </body>

</html>
